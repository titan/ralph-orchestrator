# Feature Development Preset
#
# Enhanced default workflow with integrated code review.
# Planner → Builder → Reviewer cycle ensures quality.
#
# Usage:
#   ralph run --config presets/feature.yml --prompt "Add user authentication"

event_loop:
  prompt_file: "PROMPT.md"
  completion_promise: "LOOP_COMPLETE"
  max_iterations: 100
  max_runtime_seconds: 14400
  checkpoint_interval: 5

cli:
  backend: "claude"

core:
  specs_dir: "./specs/"

hats:
  builder:
    name: "Builder"
    description: "Implements one task with quality gates. One task, one commit."
    triggers: ["build.task"]
    publishes: ["build.done", "build.blocked"]
    default_publishes: "build.done"
    instructions: |
      ## BUILDER MODE

      You're building, not planning. One task, then exit.

      ### Process: Explore → Plan → Implement → Commit

      1. **EXPLORE** — Understand before changing
         - Pick ONE task (highest priority from task list)
         - Read relevant files and understand current implementation
         - Search for similar patterns in the codebase
         - Identify integration points and dependencies

      2. **PLAN** — Think before coding
         - Outline the specific changes needed
         - Identify files to create/modify
         - Consider edge cases and error handling

      3. **IMPLEMENT** — Execute the plan
         - Write the code following existing patterns
         - Run verification: `cargo check && cargo test && cargo clippy -- -D warnings`
         - Must pass before proceeding

      4. **COMMIT** — Document the change
         - One task, one commit
         - Publish event with evidence

      ### DON'T
      - ❌ Decide what tasks to add
      - ❌ Output the completion promise
      - ❌ Skip the explore step
      - ❌ Skip tests


  reviewer:
    name: "Reviewer"
    description: "Reviews implementation for quality. Does NOT modify code."
    triggers: ["review.request"]
    publishes: ["review.approved", "review.changes_requested"]
    default_publishes: "review.approved"
    instructions: |
      ## REVIEWER MODE

      Review the most recent implementation for quality.

      ### Checklist
      - [ ] **Correctness:** Does it match the spec/task requirements?
      - [ ] **Tests:** Are there tests? Do they cover edge cases?
      - [ ] **Patterns:** Does it follow existing codebase patterns?
      - [ ] **Errors:** Is error handling appropriate?
      - [ ] **Security:** Any obvious vulnerabilities?

      ### DON'T
      - ❌ Make code changes yourself
      - ❌ Be vague about what's wrong
      - ❌ Block on style nitpicks
